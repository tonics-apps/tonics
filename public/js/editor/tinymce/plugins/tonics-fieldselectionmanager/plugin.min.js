let fieldManagerXWidth = window.innerWidth || document.documentElement.clientWidth || document.getElementsByTagName('body')[0].clientWidth;
let fieldManagerYHeight = window.innerHeight || document.documentElement.clientHeight || document.getElementsByTagName('body')[0].clientHeight;

let fieldSelectionManagerURL = '/admin/tools/field/selection-manager'

let fieldSelectionfieldSelectionInstanceAPI = null;
dataReceivedFromFieldManager = '';

function fieldSelectionManagerOnAction(editor) {
    /* Open window */
    fieldSelectionInstanceAPI = editor.windowManager.openUrl({
        title: 'Tonics Field Selection Manager',
        width: fieldManagerXWidth,
        height: fieldManagerYHeight,
        url: fieldSelectionManagerURL
    });
}

tinymce.PluginManager.add('tonics-fieldselectionmanager', function(editor, url) {
    /* Add a button that opens a window */
    editor.ui.registry.addButton('tonics-fieldselectionmanager', {
        icon: 'non-breaking',
        text: 'Field Manager',
        onAction: () => {
            fieldSelectionManagerOnAction(editor)
        }
    });

    // CONTEXT MENU
    editor.ui.registry.addMenuItem('tonics-fieldselectionmanager', {
        icon: 'non-breaking',
        text: 'Field Manager',
        onAction: () => {
            fieldSelectionManagerOnAction(editor)
        }
    });

    editor.ui.registry.addContextMenu('tonics-fieldselectionmanager', {
        update: function (element) {
            return 'tonics-fieldselectionmanager';
        }
    });

    editor.addCommand('tonics:FieldSelectedData', function (ui, value, n) {
        dataReceivedFromFieldManager = value;
        fieldSelectionInstanceAPI.close();
        tinymce.activeEditor.execCommand(
            'mceInsertContent',
            false,
            dataReceivedFromFieldManager
        );
      // tinymce.activeEditor.selection.setContent(dataReceivedFromFieldManager);
    });

    /* Return the metadata for the help plugin */
    return {
        getMetadata: function () {
            return  {
                name: 'Field Selection Manager',
                url: ''
            };
        }
    };
});