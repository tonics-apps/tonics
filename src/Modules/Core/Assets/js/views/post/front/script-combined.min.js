/*
 *     Copyright (c) 2025. Olayemi Faruq <olayemi@tonics.app>
 *
 *     This program is free software: you can redistribute it and/or modify
 *     it under the terms of the GNU Affero General Public License as
 *     published by the Free Software Foundation, either version 3 of the
 *     License, or (at your option) any later version.
 *
 *     This program is distributed in the hope that it will be useful,
 *     but WITHOUT ANY WARRANTY; without even the implied warranty of
 *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *     GNU Affero General Public License for more details.
 *
 *     You should have received a copy of the GNU Affero General Public License
 *     along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

var q=Object.defineProperty;var l=(i,e)=>q(i,"name",{value:e,configurable:!0});var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name"),w,H=(w=class{constructor(){this.$eventHandlers=new Map}attachHandlerToEvent(e,t){var n;return this.getHandlers().has(e)?((n=this.getHandlers().get(e))==null||n.push(t),this):(this.getHandlers().set(e,[t]),this)}getHandlers(){return this.$eventHandlers}detachHandlerFromEvent(e){if(this.getHandlers().has(e))return this.getHandlers().delete(e),this}getEventHandlers(e){var t;return this.getHandlers().has(e)?(t=this.getHandlers().get(e))!=null?t:[]:[]}},l(w,"EventQueue"),w);u(H,"EventQueue");window.hasOwnProperty("TonicsEvent")||(window.TonicsEvent={});window.TonicsEvent.EventQueue=()=>new H;function P(i,e){let t=new H,n=e.name;if(i.hasOwnProperty(n)){let s=i[n];return s.length>0&&(s==null||s.forEach((a,r)=>{t.attachHandlerToEvent(e,a)})),t}throw new DOMException(`Can't attach ${e} to listeners because it doesn't exist`)}l(P,"attachEventAndHandlersToHandlerProvider");u(P,"attachEventAndHandlersToHandlerProvider");window.hasOwnProperty("TonicsEvent")||(window.TonicsEvent={});window.TonicsEvent.attachEventAndHandlersToHandlerProvider=(i,e)=>P(i,e);var v,A=(v=class{constructor(e){if(e)return this.$handleProvider=e,this}dispatch(e){let t=e.constructor,n=this.getHandler().getEventHandlers(t);for(let s=0;s<n.length;s++)Object.getOwnPropertyNames(n[s]).includes("arguments")?n[s](e):new n[s](e);return e}setHandler(e){return this.$handleProvider=e,this}getHandler(){return this.$handleProvider}dispatchEventToHandlers(e,t,n){let s=P(e,n);this.setHandler(s).dispatch(t)}},l(v,"EventDispatcher"),v);u(A,"EventDispatcher");window.hasOwnProperty("TonicsEvent")||(window.TonicsEvent={});window.TonicsEvent.EventDispatcher=new A;var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name"),b,H=(b=class{constructor(){this.$eventHandlers=new Map}attachHandlerToEvent(e,t){var n;return this.getHandlers().has(e)?((n=this.getHandlers().get(e))==null||n.push(t),this):(this.getHandlers().set(e,[t]),this)}getHandlers(){return this.$eventHandlers}detachHandlerFromEvent(e){if(this.getHandlers().has(e))return this.getHandlers().delete(e),this}getEventHandlers(e){var t;return this.getHandlers().has(e)?(t=this.getHandlers().get(e))!=null?t:[]:[]}},l(b,"EventQueue"),b);u(H,"EventQueue");window.hasOwnProperty("TonicsEvent")||(window.TonicsEvent={});window.TonicsEvent.EventQueue=()=>new H;var I={OnBeforeTonicsFieldPreviewEvent:[],OnBeforeTonicsFieldSubmitEvent:[],OnBeforeScrollBottomEvent:[],OnScrollBottomEvent:[],OnDoubleClickEvent:[],OnClickEvent:[],OnShiftClickEvent:[],OnRowMarkForDeletionEvent:[],OnSubmitFieldEditorsFormEvent:[],OnAudioPlayerPlayEvent:[],OnAudioPlayerPauseEvent:[],OnAudioPlayerPreviousEvent:[],OnAudioPlayerNextEvent:[],OnAudioPlayerClickEvent:[],OnPaymentGatewayCollatorEvent:[]};window.TonicsEvent.EventConfig=I;var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name"),E,C=(E=class{constructor(e){return e?this.query(e):this}query(e){let t=document.querySelector(`${e}`);if(t)return this.setQueryResult(t),this;console.log(`Invalid class or id name - ${e}`)}setQueryResult(e){return this.$queryResult=e,this}getQueryResult(){return this.$queryResult}},l(E,"ElementAbstract"),E);u(C,"ElementAbstract");var T,S=(T=class extends C{constructor(e,t){super(e),this.$menuDetails={},this.queryAdapter=t}getQueryAdapter(){return this.queryAdapter}settings(e,t,n){return this.getMenuDetails().menu={parent:{element:this.getQueryResult(),event:""},propagate:!0,propagateElements:[],menuClass:e,buttonClass:t,subMenuClass:n,on:{button:{icon:{add:"",remove:""}},subMenu:{class:{add:"",remove:"",animation:{start:"",end:""}}}},off:{button:{icon:{add:"",remove:""}},subMenu:{class:{add:"",remove:"",animation:{start:"",end:""}}}}},this}stopPropagation(e=!0){return this.getMenuDetails().hasOwnProperty("menu")&&(this.getMenuDetails().menu.propagate=e),this}propagateElements(e=[]){return this.getMenuDetails().hasOwnProperty("menu")&&(this.getMenuDetails().menu.propagateElements=e),this}buttonIcon(e,t){if(this.getMenuDetails().hasOwnProperty("menu"))return this.getMenuDetails().menu.on.button.icon.add=e,this.getMenuDetails().menu.off.button.icon.add=t,this;throw new DOMException("No Menu Element Added")}menuIsOn(e,t){if(this.getMenuDetails().hasOwnProperty("menu"))return this.getMenuDetails().menu.on.subMenu.class.add=e,this.getMenuDetails().menu.on.subMenu.class.remove=t,this;throw new DOMException("No Menu Element Added")}menuIsOff(e,t){if(this.getMenuDetails().hasOwnProperty("menu"))return this.getMenuDetails().menu.off.subMenu.class.add=e,this.getMenuDetails().menu.off.subMenu.class.remove=t,this;throw new DOMException("No Menu Element Added")}run(){let e=this.getMenuDetails().menu.parent.element;e&&e.addEventListener("click",t=>{var n,s;let a=t.target;if(this.getMenuDetails().menu.propagate){let r=!1;this.getMenuDetails().menu.propagateElements.forEach(f=>{a.closest(f)&&(r=!0)}),r||t.stopPropagation()}if(a.closest(this.getMenuDetails().menu.buttonClass)){t.preventDefault();let r=a.closest(this.getMenuDetails().menu.buttonClass);if(r.classList.toggle("toggle-on"),r.ariaLabel="Expand child menu",r.ariaExpanded="false",r.classList.contains("toggle-on")){if(r.closest("[data-menu-depth]")){let c=r.closest("[data-menu-depth]"),h=document.querySelectorAll(`[data-menu-depth="${c.dataset.menuDepth}"]`);h.length>0&&h.forEach(m=>{let p=m.querySelector(this.getMenuDetails().menu.buttonClass);p!==r&&p&&p.classList.contains("toggle-on")&&p.click()})}r.ariaLabel="Collapse child menu",r.ariaExpanded="true"}let f=r.closest(this.getMenuDetails().menu.menuClass),o=(s=(n=this.getQueryAdapter().addNodeElement(f).in())==null?void 0:n.forward(this.getMenuDetails().menu.subMenuClass))==null?void 0:s.getQueryResult();if(o||(o=this.getQueryAdapter().addNodeElement(f).queryChildren(this.getMenuDetails().menu.subMenuClass).getQueryResult()),o.classList.contains(this.getMenuDetails().menu.on.subMenu.class.add[0]))if(this.hasAnimation(o)){let c=this.getMenuDetails().menu.off.subMenu.class.remove.find(d=>d.includes("flex")||d.includes("display-block")),h=this.getMenuDetails().menu.off.subMenu.class.remove.filter(d=>d!==c),m=this.getMenuDetails().menu.off.subMenu.class.add.find(d=>d.includes("none")),p=this.getMenuDetails().menu.off.subMenu.class.add.filter(d=>d!==m);o.classList.remove(h),o.classList.add(p),o.addEventListener("animationend",()=>{o.classList.remove(c),o.classList.add(m)},{once:!0})}else o.classList.remove(...this.getMenuDetails().menu.off.subMenu.class.remove),o.classList.add(...this.getMenuDetails().menu.off.subMenu.class.add);else o.classList.add(...this.getMenuDetails().menu.on.subMenu.class.add),o.classList.remove(...this.getMenuDetails().menu.on.subMenu.class.remove);if(this.getMenuDetails().menu.off.button.icon.add){let c=r.querySelector(".svgUse");if(c)c.getAttribute("xlink:href")===this.getMenuDetails().menu.off.button.icon.add?this.getQueryAdapter().addNodeElement(c).setSVGUseAttribute(this.getMenuDetails().menu.on.button.icon.add):this.getQueryAdapter().addNodeElement(c).setSVGUseAttribute(this.getMenuDetails().menu.off.button.icon.add);else throw new DOMException("Add class `svgUse` to svg use element")}}})}getMenuDetails(){return this.$menuDetails}closeMenuToggle(e=null){let t=this;e===null&&(e=document),e.querySelectorAll(t.getMenuDetails().menu.buttonClass).forEach(n=>{n.classList.contains("toggle-on")&&n.dataset.hasOwnProperty("menutoggle_click_outside")&&n.dataset.menutoggle_click_outside==="true"&&n.click()})}closeOnClickOutSide(e){e&&this.getMenuDetails().menu.parent.element.querySelectorAll(this.getMenuDetails().menu.buttonClass).forEach(s=>{s.setAttribute("data-menutoggle_click_outside","true")});let t=this;return document.addEventListener("click",function(n){t.closeMenuToggle()}),document.addEventListener("keyup",function(n){n.key==="Escape"&&t.closeMenuToggle()}),this}hasAnimation(e){let t=window.getComputedStyle(e,null),n=parseFloat(t.getPropertyValue("animation-duration")||"0"),s=parseFloat(t.getPropertyValue("transition-duration")||"0");return n>0||s>0}},l(T,"MenuToggle"),T);u(S,"MenuToggle");window.hasOwnProperty("TonicsScript")||(window.TonicsScript={});window.TonicsScript.MenuToggle=(i,e)=>new S(i,e);var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name"),y,C=(y=class{constructor(e){return e?this.query(e):this}query(e){let t=document.querySelector(`${e}`);if(t)return this.setQueryResult(t),this;console.log(`Invalid class or id name - ${e}`)}setQueryResult(e){return this.$queryResult=e,this}getQueryResult(){return this.$queryResult}},l(y,"ElementAbstract"),y);u(C,"ElementAbstract");var D,k=(D=class extends C{addNodeElement(e){return this.setQueryResult(e),this}forward(e){let t=this.getQueryResult().nextElementSibling;for(;t;){if(t.matches(e))return this.setQueryResult(t),this;t=t.nextElementSibling}return null}backward(e){let t=this.getQueryResult().previousElementSibling;for(;t;){if(t.matches(e))return this.setQueryResult(t),this;t=t.previousElementSibling}return null}in(){let e=this.getQueryResult().firstElementChild;return e?(this.setQueryResult(e),this):null}out(){let e=this.getQueryResult().parentElement;return e?(this.setQueryResult(e),this):null}queryChildren(e,t=!0){let n=this.getQueryResult().querySelector(e);return n?t?(this.setQueryResult(n),this):n:null}setSVGUseAttribute(e){let t=this.getQueryResult();if(t.tagName=="use")t.removeAttribute("xlink:href"),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e);else throw new DOMException("Not a valid svg use element")}},l(D,"Query"),D);u(k,"Query");window.hasOwnProperty("TonicsScript")||(window.TonicsScript={});window.TonicsScript.Query=()=>new k;var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name"),M,R=(M=class{constructor(e={}){this.$callbacks={},this.http=new XMLHttpRequest,this.headers=e,this.settings()}getCallbacks(){return this.$callbacks}settings(){this.getCallbacks().callbacks={onProgress:null}}checkIfCallbackIsSet(){if(!this.getCallbacks().callbacks)throw new DOMException("No Callbacks exist");return!0}onProgress(e){if(this.checkIfCallbackIsSet())return this.getCallbacks().callbacks.onProgress=e,this}Get(e,t){this.getHttp().open("GET",e,!0),this.setHeaders(),this.getHttp().send();let n=this;this.getHttp().onreadystatechange=function(){try{n.http.readyState===XMLHttpRequest.DONE&&(n.http.status===200?t(null,n.http.response):t(n.http.response))}catch(s){t("Something Went Wrong: "+s.description)}}}Post(e,t,n){this.getHttp().open("POST",e,!0),this.setHeaders(),this.getHttp().send(t);let s=this,a=s.getCallbacks().callbacks.onProgress;a!==null&&typeof a=="function"&&this.getHttp().upload.addEventListener("progress",function(r){a(r)}),this.getHttp().onreadystatechange=function(){try{s.http.onload=function(){n(null,s.http.responseText)}}catch(r){n("Something Went Wrong: "+r.description)}}}Put(e,t,n){this.getHttp().open("PUT",e,!0),this.setHeaders(),this.getHttp().send(t);let s=this,a=s.getCallbacks().callbacks.onProgress;a!==null&&typeof a=="function"&&this.getHttp().upload.addEventListener("progress",function(r){a(r)});try{this.http.onload=function(){s.http.status===200?n(null,s.http.response):n(s.http.response)}}catch(r){n("Something Went Wrong: "+r.description)}}Delete(e,t=null,n){this.http.open("DELETE",e,!0),this.setHeaders(),t?this.http.send(t):this.http.send();let s=this;try{this.http.onload=function(){s.http.status===200?n(null,s.http.response):n(s.http.response)}}catch(a){n("Something Went Wrong: "+a.description)}}getHeaders(){return this.headers}setHeaders(){if(this.getHeaders())for(let e in this.getHeaders())this.getHttp().setRequestHeader(e,this.getHeaders()[e])}getHttp(){return this.http}},l(M,"XHRApi"),M);u(R,"XHRApi");window.hasOwnProperty("TonicsScript")||(window.TonicsScript={});window.TonicsScript.XHRApi=(i={})=>new R(i);var g=Object.defineProperty,u=l((i,e)=>g(i,"name",{value:e,configurable:!0}),"__name");function $(i,e,t){let n,s=[],a={};for(n=0;n<i.length;n++)s.push(i[n].replace(/([-[\]{}()*+?.\\^$|#,])/g,"\\$1")),a[i[n]]=e[n];return s=s.join("|"),t=t.replace(new RegExp(s,"g"),function(r){return a[r]}),t}l($,"str_replace");u($,"str_replace");function Q(i,e="-"){return i=i.trim(),i=$(["&","@","%","$","*","<",">","+","!"],[" and"," at"," percentage"," dollar"," asterisk "," less than"," greater than"," plus","exclamation"],i),i.toLocaleString().toLowerCase().normalize("NFD").replace(/[^\S]+/g,e)}l(Q,"slug");u(Q,"slug");function N(i){return document.createElement(i).toString()!=="[object HTMLUnknownElement]"}l(N,"isValidTagName");u(N,"isValidTagName");var O,L=(O=class{constructor(e=""){this._$tableOfContentDetails={},this._tocTree=[],this._breakLoopBackward=!1,this._tocResult="",this._$tableOfContentDetails={tocContainer:e,noOfHeadersFound:0,tocDepth:4,tocNoHeadingToTrigger:2,tocLabel:"Table Of Content",tocLabelTag:"h2",tocClass:"tonics-toc"}}get breakLoopBackward(){return this._breakLoopBackward}set breakLoopBackward(e){this._breakLoopBackward=e}get tocResult(){return this._tocResult}set tocResult(e){this._tocResult=e}get tocTree(){return this._tocTree}set tocTree(e){this._tocTree=e}get $tableOfContentDetails(){return this._$tableOfContentDetails}set $tableOfContentDetails(e){this._$tableOfContentDetails=e}settings(){this._$tableOfContentDetails={tocDepth:4,tocNoHeadingToTrigger:2,tocLabel:"Table Of Content",tocLabelTag:"h2",tocClass:".tonics-toc"}}tocContainer(e){return this._$tableOfContentDetails.tocContainer=e,this}tocDepth(e){return this._$tableOfContentDetails.tocDepth=e,this}tocNoHeadingToTrigger(e){return this._$tableOfContentDetails.tocNoHeadingToTrigger=e,this}tocLabel(e){return this._$tableOfContentDetails.tocLabel=e,this}tocLabelTag(e){return this._$tableOfContentDetails.tocLabelTag=e,this}tocClass(e){return this._$tableOfContentDetails.tocClass=e,this}run(){let e=this._$tableOfContentDetails;if(document.querySelector(e.tocContainer)){let t="h1, h2, h3, h4";if(e.tocDepth<=6){t="";for(let a=1;a<=e.tocDepth;a++)a===e.tocDepth?t+=`h${a}`:t+=`h${a}, `}let n=document.querySelector(e.tocContainer).querySelectorAll(t);if(n.length<e.tocNoHeadingToTrigger)return;if(!N(e.tocLabelTag))throw new DOMException(e.tocLabelTag+" is not a valid tagName ");if(n.length>0){e.noOfHeadersFound=n.length;let a=0,r=0,f="<ul>",o={},c=[];n.forEach((h,m)=>{if(h.textContent.length>0){let p=Q(h.textContent),d=h.textContent;if(h.id=p,a=parseInt(h.tagName[1]),o={level:a,headerID:p,headerText:d},o.data=`<li data-heading_level="${a}"><a href="#${p}"><span class="toctext">${d}</span></a>`,this.tocTree.length===0)this.pushToTree(o);else{if(this.tocTree[r].level===a&&(this.tocTree[r].data+="</li>"+o.data),a>this.tocTree[r].level&&(this.tocTree[r].data+="<ul>",this.pushToTree(o),r=this.tocTree.length-1,c.push(o)),a<this.tocTree[r].level){let x=0;for(let _ of this.loopTreeBackward(c))_.level>a&&(_.data+="</li>",c.pop(),x++),_.level===a&&(this.breakLoopBackward=!0);o.data="</ul></li>".repeat(x)+o.data,this.pushToTree(o),r=this.tocTree.length-1}m===n.length-1&&(this.tocTree[r].data+="</li>")}}}),this.tocTree.forEach(h=>{f+=h.data}),f+="</ul>",f=`<div class="${e.tocClass}"> <${e.tocLabelTag}> ${e.tocLabel} </${e.tocLabelTag}> ${f} </div>`,this._tocResult=f}}}pushToTree(e){e.index=this.tocTree.length,this.tocTree.push(e)}*loopTreeBackward(e=null){e===null&&(e=this.tocTree);for(let t=e.length-1;t>=0&&!this.breakLoopBackward;t--)yield e[t];this.breakLoopBackward=!1}},l(O,"TableOfContent"),O);u(L,"TableOfContent");window.hasOwnProperty("TonicsScript")||(window.TonicsScript={});window.TonicsScript.TableOfContent=i=>new L(i);var F=new L(".entry-content");F.tocDepth(6).run();try{new S(".site-nav",new k).settings(".menu-block",".dropdown-toggle",".child-menu").buttonIcon("#tonics-arrow-up","#tonics-arrow-down").menuIsOff(["swing-out-top-fwd","d:none"],["swing-in-top-fwd","d:flex"]).menuIsOn(["swing-in-top-fwd","d:flex"],["swing-out-top-fwd","d:none"]).closeOnClickOutSide(!0).run()}catch(i){console.error("An Error Occur Setting MenuToggle: Site-Nav")}export{A as EventDispatcher,H as EventQueue,S as MenuToggle,k as Query,L as TableOfContent,R as XHRApi};
