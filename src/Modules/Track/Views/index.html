[[inherit("Modules::Core/Views/Templates/core", "Modules::Core/Views/Templates/extends/in_main_form_and_filter")]]

[[hook_into('Core::in_head_title')Track Index]]
[[hook_into('Core::in_main_header_title')Tracks]]

[[b('admin_track_query_callback')


<li data-list_id="[[_v('QUERY_MODE.admin_track_query.list_id')]]" data-track_slug="[[_v('QUERY_MODE.admin_track_query.track_slug')]]"
    data-track_id="[[_v('QUERY_MODE.admin_track_query.track_id')]]"
    data-track_title="[[_v('QUERY_MODE.admin_track_query.track_title')]]"
    data-db_click_link="[[_v('QUERY_MODE.admin_track_query.edit_link')]]"
    tabindex="0" class="d:flex flex-d:column align-items:center justify-content:center cursor:pointer no-text-highlight"
    data-selected="false">
  <fieldset class="padding:default width:100% draggable d:flex justify-content:center">
    <legend class="bg:pure-black color:white padding:default">[[_v('QUERY_MODE.admin_track_query.genre_name')]]</legend>
    <div class="admin-widget-information owl width:100%">
      <div class="text-on-admin-util text-highlight">[[_v('QUERY_MODE.admin_track_query.track_title')]]</div>

      <div class="form-group d:flex flex-gap:small flex-wrap:wrap">
        <a href="[[_v('QUERY_MODE.admin_track_query.edit_link')]]" class="text-align:center bg:transparent border:none color:black bg:white-one border-width:default border:black padding:small
                        margin-top:0 cursor:pointer">Edit</a>

        <a href="[[_v('QUERY_MODE.admin_track_query.preview_link')]]" target="_blank" class="text-align:center bg:transparent border:none color:black bg:white-one border-width:default border:black padding:small
                        margin-top:0 cursor:pointer">Preview</a>

        [[if('v[QUERY_MODE.admin_track_query.destroy_link]')
        <form method="post" class="d:contents" action="[[_v('QUERY_MODE.admin_track_query.destroy_link')]]">
          <input type="hidden" name="token" value="[[csrf()]]">
          <button [[_v('QUERY_MODE.admin_track_query.button_data_attr')]] type="button" class="listing-button bg:pure-black color:white border:none border-width:default border:black padding:small
          margin-top:0 cursor:pointer">[[_v('QUERY_MODE.admin_track_query.destroy_text')]]
          </button>
        </form>
        ]]
      </div>

    </div>
  </fieldset>
</li>
]]

[[hook_into('Core::after_in_main_form_and_filter_date')
<div class="child-menu width:100% flex-d:column swing-in-top-fwd d:flex">
  <div class="menu-box-checkbox-items max-height:300px overflow:auto">Choose Genres (All By Default)
    <ul class="menu-box-radiobox-items list:style:none">
      [[_v('DefaultGenresMetaBox')]]
    </ul>
  </div>
</div>
]]

[[hook_into('Core::after_in_main_form_and_filter')

  [[SQL_BLOCK('reusable_sql')
    [[FROM('tracks')]]
    [[JOIN('genres.genre_id', 'tracks.fk_genre_id')]]
  ]]
  
  [[SQL_BLOCK('reusable_search_sql')
    [[OP('=')]]
    [[if('v[URL.PARAMS.status] == block[empty]')
      [[PARAM('1')]]
    ]]
    [[if('v[URL.PARAMS.status] !== block[empty]')
      [[PARAM('v[URL.PARAMS.status]')]]
    ]]
    
    [[if('v[URL.PARAMS.start_date] && v[URL.PARAMS.end_date]')
      [[OP('AND')]]  [[SELECT('tracks') [[COLS('PICK', 'created_at')]] ]] [[KEYWORD('BETWEEN')]]
      [[SQLFUNC('DATE_FORMAT', "v[URL.PARAMS.start_date], %Y-%m-%d %H:%i:%s")]] [[OP('AND')]] [[SQLFUNC('DATE_FORMAT', "v[URL.PARAMS.end_date], %Y-%m-%d %H:%i:%s")]]
    ]]

    [[if('v[URL.PARAMS.genre] !== block[empty]')
      [[OP('AND')]] [[SELECT('genres') [[COLS('PICK', 'genre_id')]] ]] [[SQLFUNC('IN', "v[URL.PARAMS.genre]")]]
    ]]
    
    [[if('v[URL.PARAMS.query] !== block[empty]')
      [[OP('AND')]]  [[SELECT('tracks') [[COLS('PICK', 'track_title')]] ]]
      [[KEYWORD('LIKE')]] [[SQLFUNC('CONCAT', "%,v[URL.PARAMS.query],%")]]
    ]]
  
  ]]
  
  [[SQL('admin_track_query_table_count')
    [[SQLFUNC('COUNT', "*")]]
    [[REUSE_SQL('reusable_sql')]]
    [[WHERE('tracks.track_status')
      [[REUSE_SQL('reusable_search_sql')]]
    ]]
  ]]
  
  [[SQL('admin_track_query_get_row_with_offset_limit')
    [[SELECT('tracks') [[COLS('ALL')]] ]] [[SELECT('genres') [[COLS('PICK', 'genre_name')]] ]]
    [[REUSE_SQL('reusable_sql')]]
    [[WHERE('tracks.track_status')
      [[REUSE_SQL('reusable_search_sql')]]
      [[ORDER('tracks.created_at', 'DESC')]]
      [[KEYWORD('LIMIT')]] [[PARAM('v[QUERY_MODE.LIMIT]')]]
      [[KEYWORD('OFFSET')]] [[PARAM('v[QUERY_MODE.OFFSET]')]]
    ]]
  ]]
  
  <ul id="sfc" class="admin-widget list:style:none d:flex flex-wrap:wrap justify-content:center flex-gap padding:default">
    [[Query('admin_track_query', 'App\Modules\Track\Helper\TrackLoop', 'admin_track_query_callback')]]
  </ul>
  
  [[_use('pagination')]]

]]

[[hook_into('Core::after_main')
<form id="selectUtilitiesForm" method="get" action="" class="margin-top:0 admin-select-utilities d:flex flex-gap flex-wrap:wrap justify-content:center padding:default">
  <input type="hidden" name="token" value="[[csrf()]]" >
  <div class="form-group">
    [[func('SelectUtilitiesForm::ActionGroup', 'SelectUtilitiesForm::ActionGroup::MoreActionForTrack')]]
  </div>
</form>
]]

[[hook_into('Core::before_footer')
  [[_use("script:variables")]]
  [[_use("script:track-index")]]
  [[_use("session:delete-artifacts")]]
]]