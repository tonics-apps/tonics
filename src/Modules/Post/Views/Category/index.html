[[inherit("Modules::Core/Views/Templates/core", "Modules::Core/Views/Templates/extends/in_main_form_and_filter")]]
[[import("Modules::Core/Views/Blocks/Post")]]

[[hook_into('in_head_title')Posts Category Index]]
[[hook_into('in_main_header_title')Posts Category]]

[[b('admin_post_category_query_callback')


<li data-list_id="[[_v('QUERY_MODE.admin_post_category_query.list_id')]]" data-cat_slug="[[_v('QUERY_MODE.admin_post_category_query.cat_slug')]]"
    data-cat_id="[[_v('QUERY_MODE.admin_post_category_query.cat_id')]]"
    data-cat_title="[[_v('QUERY_MODE.admin_post_category_query.cat_name')]]"
    data-db_click_link="[[_v('QUERY_MODE.admin_post_category_query.edit_link')]]"
    tabindex="0" class="d:flex flex-d:column align-items:center justify-content:center cursor:pointer no-text-highlight"
    data-selected="false">
    <fieldset class="padding:default width:100% draggable d:flex justify-content:center">
        <legend class="bg:pure-black color:white padding:default">[[_v('QUERY_MODE.admin_post_category_query.cat_name')]]</legend>
        <div class="admin-widget-information owl width:100%">
            <div class="text-on-admin-util text-highlight">[[_v('QUERY_MODE.admin_post_category_query.cat_name')]]</div>

            <div class="form-group d:flex flex-gap:small flex-wrap:wrap">
                <a href="[[_v('QUERY_MODE.admin_post_category_query.edit_link')]]" class="text-align:center bg:transparent border:none color:black bg:white-one border-width:default border:black padding:small
                        margin-top:0 cursor:pointer">Edit</a>

                <a href="[[_v('QUERY_MODE.admin_post_category_query.preview_link')]]" target="_blank" class="text-align:center bg:transparent border:none color:black bg:white-one border-width:default border:black padding:small
                        margin-top:0 cursor:pointer">Preview</a>
                <form method="post" class="d:contents" action="[[_v('QUERY_MODE.admin_post_category_query.destroy_link')]]">
                    <input type="hidden" name="token" value="[[csrf()]]">
                    <button [[_v('QUERY_MODE.admin_post_category_query.button_data_attr')]] type="button" class="listing-button bg:pure-black color:white border:none border-width:default border:black padding:small
        margin-top:0 cursor:pointer">[[_v('QUERY_MODE.admin_post_category_query.destroy_text')]]
                    </button>
                </form>
            </div>

        </div>
    </fieldset>
</li>
]]

[[hook_into('after_in_main_form_and_filter')

    [[SQL_BLOCK('reusable_sql')[[FROM('categories')]] ]]

    [[SQL_BLOCK('reusable_search_sql')
        [[OP('=')]]
        [[if('v[URL.PARAMS.status] == block[empty]')
            [[PARAM('1')]]
        ]]
        [[if('v[URL.PARAMS.status] !== block[empty]')
            [[PARAM('v[URL.PARAMS.status]')]]
        ]]

        [[if('v[URL.PARAMS.start_date] && v[URL.PARAMS.end_date]')
            [[OP('AND')]]  [[SELECT('categories') [[COLS('PICK', 'created_at')]] ]] [[KEYWORD('BETWEEN')]]
            [[SQLFUNC('DATE_FORMAT', "v[URL.PARAMS.start_date], %Y-%m-%d %H:%i:%s")]] [[OP('AND')]] [[SQLFUNC('DATE_FORMAT', "v[URL.PARAMS.end_date], %Y-%m-%d %H:%i:%s")]]
        ]]

        [[if('v[URL.PARAMS.query] !== block[empty]')
            [[OP('AND')]]  [[SELECT('categories') [[COLS('PICK', 'cat_name')]] ]]
            [[KEYWORD('LIKE')]] [[SQLFUNC('CONCAT', "%,v[URL.PARAMS.query],%")]]
        ]]
    ]]

    [[SQL('admin_post_category_query_table_count')
        [[SQLFUNC('COUNT', "*")]]
        [[REUSE_SQL('reusable_sql')]]
        [[WHERE('categories.cat_status')
            [[REUSE_SQL('reusable_search_sql')]]
        ]]
    ]]

    [[SQL('admin_post_category_query_get_row_with_offset_limit')
        [[SELECT('categories') [[COLS('ALL')]] ]]
        [[REUSE_SQL('reusable_sql')]]
        [[WHERE('categories.cat_status')
            [[REUSE_SQL('reusable_search_sql')]]
            [[ORDER('categories.created_at', 'DESC')]]
            [[KEYWORD('LIMIT')]] [[PARAM('v[QUERY_MODE.LIMIT]')]]
            [[KEYWORD('OFFSET')]] [[PARAM('v[QUERY_MODE.OFFSET]')]]
        ]]
    ]]

    <ul id="sfc" class="admin-widget list:style:none d:flex flex-wrap:wrap justify-content:center flex-gap padding:default">
        [[Query('admin_post_category_query', 'App\Modules\Post\Helper\PostCategoryLoop', 'admin_post_category_query_callback')]]
    </ul>
    
    [[_use('pagination')]]

]]


[[hook_into('after_main')
<form id="selectUtilitiesForm" method="get" action="" class="margin-top:0 admin-select-utilities d:flex flex-gap flex-wrap:wrap justify-content:center padding:default">
    <input type="hidden" name="token" value="[[csrf()]]" >
    <div class="form-group">
        [[func('SelectUtilitiesForm::ActionGroup', 'SelectUtilitiesForm::ActionGroup::MoreActionForCategory')]]
    </div>
</form>
]]


[[hook_into('before_footer')
    [[_use("script:variables")]]
    [[_use("script:post-category-index")]]
    [[_use("session:delete-artifacts")]]
]]